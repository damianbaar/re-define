(function (parent, factory){
  if (typeof define === 'function' && define.amd) {
    define('{{{config.name}}}', [{{{chain external map '\'|\'' reduce}}}], factory)
  } else if (typeof exports === 'object') {
  module.exports = factory({{{chain external map 'require(\'|\')' reduce}}})
  } else {
    {{#each external}}var {{{escape this}}} = {{{global this}}}
    {{/each}}
    {{#if config.returns}}parent['{{{config.name}}}'] = {{/if}}factory({{{chain external escape}}})
  }
  }(this, function ({{{chain external escape}}}) {
  var {{{config.scopeVar}}} = {}
  {{#each bundles}}(function() {
    {{{this.code}}}
    this.{{{this.returns}}} = {{{this.returns}}}
    }).call(this);
    {{/each}}

  function {{{config.internalRequire}}} (name) { return {{{config.scopeVar}}}[name] }

    {{#if config.returns }} return {{{config.returns}}} {{/if}}
}))
