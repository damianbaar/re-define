(function (parent, factory){
  if (typeof define === 'function' && define.amd) {
    define('{{{config.name}}}', [{{{chain external map '\'|\'' reduce}}}], factory)
  } else if (typeof exports === 'object') {
  module.exports = factory({{{chain external map 'require(\'|\')' reduce}}})
  } else {
    {{#each external}}var {{{escape this}}} = {{{global this}}}
    {{/each}}
    {{#if config.returns}}parent['{{{config.name}}}'] = {{/if}}factory({{{chain external escape}}})
  }
  }(this, function ({{{chain external escape}}}) {

  var {{{config.scopeVar}}} = {}

  {{#each bundles}}var {{{this.name}}} = (function() {
    {{{this.code}}}
    return {{{this.returns}}}
    })();
    {{/each}}

  function {{{config.requireFunc}}} (name) { 
    name = name.replace(/\.+\//g, '')
    return {{{config.scopeVar}}}[name] || [{{{chain external escape}}}][[{{{chain external map '\'|\''}}}].indexOf(name)]
  }

    {{#if config.returns }} return {{{config.returns}}} {{/if}}
}))
